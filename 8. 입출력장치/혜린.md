# Ch.8 입출력장치

## 8-1 장치 컨트롤러와 장치 드라이버

### 장치 컨트롤러

입출력 장치는 장치 컨트롤러를 통해 컴퓨터 내부와 정보를 주고 받는 역할을 한다. 구체적으로 아래와 같은 문제들을 해결한다.

- CPU와 입출력장치 간의 통신 중개
- 오류 검출
- 데이터 버퍼링
    - 버퍼링: 전송률이 높은 장치와 낮은 장치 사이에 주고 받는 데이터를 버퍼라는 임시 저장 공간에 저장하여 전송률을 비슷하게 맞추는 방법

### 내부 구조

- 데이터 레지스터: CPU와 입출력 장치 사이에 주고받을 데이터가 담기는 레지스터 (버퍼 역할)
- 상태 레지스터: 입출력 장치가 입출력 작업을 할 준비가 되었는지, 입출력 작업이 완료되었는지, 입출력 장치에 오류는 없는지 등의 상태 정보가 저장됨
- 제어 레지스터: 입출력 장치가 수행할 내용에 대한 제어 정보와 명령을 저장

### 장치 드라이버

- 장치 컨트롤러의 동작을 감지하고 제어함으로써 장치 컨트롤러가 컴퓨터 내부와 정보를 주고받을 수 있게 하는 프로그램
- 장치 컨트롤러가 입출력장치를 연결하기 위한 하드웨어적인 통로라면 장치 드라이버는 입출력장치를 연결하기 위한 소프트웨어적인 통로
- 장치 드라이버를 인식하고 실행하는 주체는 macOS, 윈도우와 같은 운영체제

### 8-2 다양한 입출력 방법

CPU와 장치 컨트롤러가 정보를 주고 받는 방법은 다양하게 존재한다.

1. 프로그램 입출력
    
    프로그램 속 명령어로 입출력 장치를 제어하는 방법. CPU가 프로그램 속 명령어를 실행하는 과정에서 입출력 명령어를 만나면 CPU는 입출력장치에 연결된 장치 컨트롤러와 상호작용하며 입출력 작업을 수행함
    
    그렇다면 CPU는 여러 장치 컨트롤러 속 레지스터들을 모두 알고 있기 어려울텐데 어떻게 명령어로 표현하고 메모리에 어떻게 저장되어 있을까?
    
    - 메모리 맵 입출력
        
        메모리에 접근하기 위한 주소 공간과 입출력장치에 접근하기. 메모리에 접근하는 명령어와 입출력장치에 접근하는 명령어가 다르지 않음
        
    - 고립형 입출력
        
        메모리를 위한 주소 공간과 입출력장치를 위한 주소 공간을 분리하는 방법. 메모리에 접근하는 명령어와 입출력장치에 접근하는 명령어가 다름
        
2. 인터럽트 기반 입출력
    
    CPU는 장치 컨트롤러에 입출력 작업을 명령하고 장치 컨트롤러가 입출력장치를 제어하며 입출력을 수행하는 동안 CPU는 다른 일을 할 수 있다. 장치 컨트롤러가 입출력 작업을 끝낸 뒤 CPU에게 인터럽트 요청 신호를 보내면 CPU는 하던 일을 잠시 백업하고 인터럽트 서비스 루틴을 실행한다.
    
    - 만약 여러 입출력장치에서 인터럽트가 동시에 발생한다면?
        - PIC라는 하드웨어를 이용함. PIC는 여러 장치 컨트롤러에 연결되어 장치 컨트롤러에서 보낸 하드웨어 인터럽트 요청들의 우선순위를 판별한 뒤 CPU에 지금 처리해야할 하드웨어 인터럽트는 무엇인지를 알려주는 장치 (참고로 우선 순위가 가장 높은 NMI까지 우선순위를 반별하지는 않음)
3. DMA 입출력
    - 입출력 장치가 메모리와 CPU를 거치지 않고도 상호작용할 수 있는 방식. 직접 메모리에 접근할 수 있는 입출력 기능이다.
    - DMA 컨트롤러가 CPU가 시스템 버스를 이용하지 않을 때마다 시스템 버스를 조금씩 이용하거나 CPU가 일시적으로 시스템 버스를 이용하지 않도록 허락을 구하고 시스템 버스를 집중적으로 이용한다.
        - DMA를 위해 시스템 버스를 너무 자주 이용하면 그만큼 CPU가 이용하지 못함.
        - 따라서 DMA 컨트롤러와 장치 컨트롤러들을 입출력 버스라는 버스 연결하여 문제를 해결함
