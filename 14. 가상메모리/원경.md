# Chapter 14. 가상 메모리
## 14-1. 연속 메모리 할당
연속 메모리 할당은 프로세스에 연속적인 물리 메모리 공간을 할당하는 방식이다.

### 스와핑
- 실행되지 않는 프로세스를 보조기억장치(스왑 영역)로 이동시켜 메모리 공간 확보.
- **스왑 아웃**: 메모리 → 스왑 영역으로 프로세스 이동.
- **스왑 인**: 스왑 영역 → 메모리로 프로세스 복귀 (위치 변경 가능).

### 메모리 할당
- **최초 적합**: 첫 번째로 발견된 공간에 할당.
- **최적 적합**: 가장 작은 공간 선택.
- **최악 적합**: 가장 큰 공간에 할당.

### 외부 단편화
- **문제**: 메모리 조각화로 인한 공간 낭비.
- **해결 방안**
    - **압축**: 프로세스 재배치로 빈 공간 통합.
    - **페이징**: 불연속 할당을 통한 단편화 해결 (핵심 기법).

## 14-2. 페이징을 통한 가상 메모리 관리
### 페이징이란
- **구조**
    - **페이지**: 가상 메모리 분할 단위 (일정 크기).
    - **프레임**: 물리 메모리 분할 단위 (페이지와 동일 크기).
- **동작**
    - 필요한 페이지만 메모리에 적재 (**페이지 인**).
    - 미사용 페이지는 보조기억장치로 이동 (**페이지 아웃**).
- **장점**: 외부 단편화 해결 및 물리 메모리 한계 극복.

### 페이지 테이블
- **역할**: 페이지 번호 → 프레임 번호 매핑.
- **구성**
    - **PTBR (페이지 테이블 기준 레지스터)**: 현재 프로세스의 페이지 테이블 위치 저장.
    - **엔트리 구조**:
        - **유효 비트**: 메모리 적재 여부 (0 = 페이지 폴트 유발).
        - **보호 비트**: 읽기/쓰기/실행 권한 관리.
        - **참조 비트**: 접근 기록 여부.
        - **수정 비트**: 데이터 변경 여부 (**더티 비트**).
- **주소 변환**
    - 논리 주소 = `<페이지 번호, 변위>`.
    - 물리 주소 = `<프레임 번호, 변위>` (변위 값 동일).

### 최적화 기술
- **TLB (변환 색인 버퍼)**: 자주 접근하는 페이지 정보 캐싱.
- **쓰기 시 복사**: 부모-자식 프로세스 간 페이지 공유 시 복사 지연.
- **계층적 페이징**: 다단계 페이지 테이블로 메모리 사용량 감소.

## 14-3. 페이지 교체와 프레임 할당
가상 메모리를 통해 작은 메모리보다 큰 프로세스도 실행이 가능해졌다.
그럼에도 여전히 물리 메모리의 크기는 한정적이다.

### 요구 페이징
- **원리**: 실행 시 필요한 페이지만 적재.
- **페이지 폴트**: 접근한 페이지가 메모리 없을 때 발생 (유효 비트=0).
- **처리 과정**
    1. 페이지 폴트 발생 → 인터럽트 처리.
    2. 보조기억장치에서 페이지 적재.
    3. 유효 비트 1로 갱신 후 명령 재실행.

### 페이지 교체 알고리즘
- **FIFO**: 가장 먼저 적재된 페이지 교체.
- **최적**: 미래 참조 횟수 최소인 페이지 교체 (이론적 기준).
- **LRU**: 가장 오래전에 사용된 페이지 교체 (실용적).

### 스래싱과 프레임 할당
- **스래싱**: 과도한 페이지 교체로 CPU 이용률 저하.
- **프레임 할당 전략**
    - **정적 할당**:
        - 균등 할당: 모든 프로세스에 동일 프레임 수.
        - 비례 할당: 프로세스 크기 비례하여 프레임 배분.
    - **동적 할당**:
        - 작업 집합 모델: 최근 참조 페이지 집합 기반 프레임 할당.
        - 페이지 폴트 빈도: 폴트율 임계값으로 프레임 조정.