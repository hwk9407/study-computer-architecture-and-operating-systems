# Ch. 10 프로세스와 스레드

### 10-1 프로세스 개요

- 프로세스: 실행 중인 프로그램을 말한다.
    - 포그라운드 프로세스: 사용자가 보는 앞에서 실행되는 프로세스
    - 백그라운드 프로세스: 사용자가 보지 못하는 뒤편에서 실행되는 프로세스
        - 유닉스계열에서는 데몬, 윈도우 운영체제에서는 서비스라고 부른다.

- 프로세스 제어 블록(PCB): 빠르게 번갈아 수행되는 프로세스의 실행 순서를 관리하고 프로세스에 CPU를 비롯한 자원을 배분하기 위해 해당 프로세스를 식별하기 위한 정보를 저장하는데 이것을 프로세스 제어 블록이라고 한다.
- PCB에 딤기는 정보들
    - 프로세스 ID(PID): 특정 프로세스를 식별하기 위해 부여하는 고유한 번호
    - 레지스터 값: 자신의 실행상태가 돌아오면 이전까지 사용했던 레지스터 중간값을 모두 복원한다.
    - 프로세스 상태: 현재 프로세스가 어떤 상태인지 기록
    - CPU 스케줄링 정보: 프로세스가 언제, 어떤 순서로 CPU를 할당받을지에 대한 정보
    - 메모리 관리 정보: 프로세스마다 메모리에 저장된 위치가 다르기 때문에 프로세스가 어느 주소에 저장되어 있는지에 대한 정보가 있어야 한다.
    - 사용한 파일과 입출력 장치 목록

A에서 B 프로세스로 CPU 사용이 넘어가는 경우 A의 값을 백업해야 한다.

- 문맥: 하나의 프로세스 수행을 재개하기 위해 기억해야 할 정보
- 문맥 교환: 기존 프로세스의 문맥을 PCB에 백업하고, 새로운 프로세스를 실행하기 위해 문맥을 PCB로부터 복구하여 새로운 프로세스를 실행하는 것.

프로세스가 생성되면 커널영역에 PC가 생성된다. 그렇다면 사용자 영역에는 프로세스가 어떻게 배치될까?

- 정적 할당 영역: 크키가 고정된 영역
    - 코드영역: 실행할 수 있는 코드, 즉 기계어로 이뤄진 명령어가 저장된다. 읽기 전용 공간이다.
    - 데이터 영역: 프로그램이 실행되는 동안 유지할 데이터가 저장되는 공간이다.
- 동적 할당 영역: 프로세스 실행과정에서 크기가 변할 수 있는 영역
    - 힙 영역: 프로그램을 만드는 사용자, 즉 프로그래머가 직접 할당할 수 있는 저장 공간. 해당 공간을 반납하지 않으면 메모리 누수가 발생한다. ex. 전역 변수
    - 스택 영역: 데이터를 일시적으로 저장하는 공간 ex. 매개 변수, 지역변수
    

### 10-2 프로세스 상태와 계층 구조

프로세스가 가질 수 있는 대표적인 상태는 아래와 같다.

- 생성 상태: 프로세스를 생성 중인 상태. 생성 상태를 거친 뒤 곧바로 실행되진 않고 CPU의 할당을 기다린다.
- 준비 상태: 바로 CPU를 할당받아 실행할 수 있지만 자기차례가 아니기에 기다리고 있는 상태이다.
- 실행상태: CPU를 할당받아 실행 중인 상태를 말한다.
- 대기 상태: 입출력 작업은 CPU에 비해 처리 속도가 느리다. 입출력 장치의 작업을 기다리는 상태
- 종료 상태: 프로세스가 종료된 상태. PCB와 프로세스가 사용한 메모리를 정리한다.

프로세스는 실행도중 시스템 호출을 통해 다른 프로세스를 실행할 수 있다. 

- 부모 프로세스: 새 프로세스를 생성한 프로세스
- 자식 프로세스: 부모 프로세스에 의해 생성된 프로세스

부모 프로세스는 fork를 통해 자신의 복사본을 자식 프로세스로 생성해내고, 만들어진 복사본은 exec를 통해 자신의 메모리 공간으로 다른 프로그램으로 교체한다. 프로세스 계층 구조가 만들어지는 과정은 fork와 exec가 반복되는 과정이다. 

### 10-3 스레드

- 스레드: 프로세스를 구성하는 실행의 흐름 단위이다.

프로세스의 스레드들은 실행에 필요한 최소한의 정보(프로그램 카운터를 포함한 레지스터, 스택)만을 유지한 채 프로세스 자원을 공유하며 실행된다. 프로세스 자원을 공유한다는 것이 핵심이다.

- 리눅스는 프로세스와 스레드 간에 명확한 구분을 짓지 않는다. 대신 태스크라는 이름으로 통일하여 명명한다.

하나의 프로세스에 여러 스레드가 있을 수 있다.

- 멀티 프로세스: 여러 프로세스를 동시에 실행하는 것
- 멀티 스레드: 여러 스레드로 프로세스를 동시에 실행하는 것

동일한 작업을 수행하는 단일 스레스 프로세스 여러 개를 실행하는 것과 하나의 프로세스를 여러 스렏로 실행하는 것은 무엇이 다를까?

- 프로세스끼리는 기본적으로 자원을 공유하지 않지만 스레드끼리는 같은 프로세스 내의 자원을 공유한다.
- 따라서 메모리를 더 효율적으로 사용할 수 있고 통신에 유리하다.
- 하지만 하나의 스레드에 문제가 생기면 프로세스 전체에 문제가 생길 수 있다.

프로세스는 기본적으로 자원을 공유하지 않지만, 프로세스끼리도 충분히 자원을 공유하고 데이터를 주고받을 수 있다. 이를 프로세스 간 통신이라고 한다.

- 파일을 통한 프로세스간 통신
- 공유 메모리: 프로세스들이 공유할 수 있는 메모리 영역
