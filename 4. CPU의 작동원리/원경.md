# Chapter 04. CPU의 작동 원리
## 04-1. ALU와 제어장치
### CPU의 주요 구성 요소
- **ALU(Arithmetic Logic Unit, 산술논리연산장치)**: 산술 및 논리 연산을 담당
- **제어장치(Control Unit)**: 명령어를 읽고 해석하며, 제어 신호를 통해 CPU와 주변 장치의 동작을 관리
- **레지스터(Register)**: 데이터와 명령어를 임시로 저장하는 고속 기억장치
### ALU
- 입력: 레지스터로부터 피연산자, 제어장치로부터 연산 종류를 지정하는 제어 신호를 받음
- 연산: 산술(덧셈, 뺄셈 등) 및 논리(AND, OR 등) 연산 수행
- 출력: 연산 결과와 플래그를 레지스터에 저장. 이 결과는 숫자, 문자, 메모리 주소 등 다양할 수 있음- **
- **플래그(Flag)**: 연산 결과에 대한 **추가 정보**로, 플래그 레지스터에 저장됨
  - **부호 플래그(Sign Flag)**: 결과의 부호(양수/음수) 표시
  - **제로 플래그(Zero Flag)**: 결과가 0인지 여부
  - **캐리 플래그(Carry Flag)**: 덧셈/뺄셈에서 올림/빌림 발생 여부
  - **오버플로우 플래그(Overflow Flag)**: 연산 결과가 표현 범위를 넘었는지 여부
  - **인터럽트 플래그(Interrupt Flag)**: 인터럽트 허용 여부
  - **슈퍼바이저 플래그(Supervisor Flag)**: 현재 모드(커널/사용자) 표시

### 제어장치
- **역할**: 명령어를 읽어 들이고 해석, 각 부품에 제어 신호를 전달하여 CPU와 시스템 전체의 동작을 조정
- **입력 정보**
  - **클럭 신호**: 동작 타이밍을 결정
  - **명령어**: 명령어 레지스터(IR)에 저장된 명령어 해석
  - **플래그 값**: 플래그 레지스터의 상태를 참고해 제어 신호 결정
  - **시스템 버스 신호**: 외부 장치와의 상호작용

## 04-2. 레지스터
### 레지스터의 역할
- CPU 내부의 임시 저장소로, 데이터와 명령어를 빠르게 저장/읽기 가능
- 프로그램 실행 흐름과 상태를 파악하는 데 핵심적

### 레지스터 종류

|레지스터|역할 및 설명|
|---|---|
|프로그램 카운터(PC)|다음에 실행할 명령어의 주소 저장|
|명령어 레지스터(IR)|현재 해석 중인 명령어 저장|
|메모리 주소 레지스터(MAR)|접근할 메모리 주소 저장|
|메모리 버퍼 레지스터(MBR/ MDR)|메모리와 주고받을 데이터 저장|
|범용 레지스터(GPR)|다양한 연산과 데이터 임시 저장에 사용|
|플래그 레지스터|연산 결과 및 CPU 상태 정보 저장|
|스택 포인터(SP)|스택의 최상단 주소 저장|
|베이스 레지스터(BR)|베이스 주소 지정 방식에서 기준 주소 저장|

### 프로그램 실행 과정 요약
1. 실행할 프로그램이 메모리에 저장됨
2. 프로그램 카운터에 첫 명령어 주소 저장
3. 주소 버스를 통해 메모리 주소 레지스터에 주소 전달
4. 제어 신호와 주소가 각각 제어 버스, 주소 버스를 통해 메모리로 전달
5. 메모리에서 데이터가 데이터 버스를 통해 메모리 버퍼 레지스터로 이동, 프로그램 카운터는 증가
6. 명령어 레지스터로 명령어 이동
7. 제어장치가 명령어 해석 및 제어 신호 발생

### 주소 지정 방식
- **스택 주소 지정**: **스택 포인터**를 이용해 스택 영역의 데이터를 참조
- **변위(Displacement) 주소 지정**: 오퍼랜드 값과 특정 레지스터 값을 더해 유효 주소 계산
  - **상대 주소 지정**: 오퍼랜드 + 프로그램 카운터
  - **베이스 레지스터 주소 지정**: 오퍼랜드 + 베이스 레지스터

## 04-3. 명령어 사이클과 인터럽트
### 명령어 사이클
- **정의**: 프로그램의 각 명령어가 CPU에서 실행되는 반복 주기
- **주요 단계**
  - **인출(Fetch) 사이클**: 메모리에서 명령어를 읽어옴
  - **실행(Execute) 사이클**: 읽어온 명령어를 실행
  - **간접(Indirect) 사이클**: 추가 메모리 접근이 필요한 경우 수행

### 인터럽트(Interrupt)
- **정의**: CPU의 작업 흐름을 일시적으로 중단시키는 신호
- **종류**
  - **동기 인터럽트(예외, Exception)**: CPU 내부에서 발생(예: 0으로 나누기 등)
  - **비동기 인터럽트(하드웨어 인터럽트)**: 외부 장치(I/O 등)에서 발생
- **처리 과정**
  1. 외부 장치가 인터럽트 요청 신호 보냄
  2. CPU는 명령어 인출 전 인터럽트 여부 확인
  3. 인터럽트 플래그 상태 체크(허용 여부)
  4. 허용 시 현재 작업 백업
  5. 인터럽트 벡터로 서비스 루틴(핸들러) 실행
  6. 서비스 루틴 종료 후 백업한 작업 복구 및 실행 재개

### 예외의 종류
- **폴트(Fault)**: 예외 처리 후, 예외 발생 명령어부터 재실행
- **트랩(Trap)**: 예외 처리 후, 다음 명령어부터 실행(주로 디버깅 용도)
- **중단(Abort)**: 심각한 오류로 프로그램 실행 중단